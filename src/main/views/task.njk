{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "govuk/components/panel/macro.njk" import govukPanel %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}

{% extends "template.njk" %}

<!-- You may want to make further use of these components: https://design-system.service.gov.uk/components/
but ultimately it is up to you -->

{% block content %}
  {{ govukBreadcrumbs({
    items: [
      {
        text: "Home",
        href: "/"
      },
      {
        text: "Task Status",
        href: "/status"
      },
      {
        text: task.formattedStatus,
        href: "/status/" + task.status
      },
      {
        text: "Task Details",
        href: "#"
      }
    ]
  }) }}
  <h1 class="govuk-heading-xl">Your task list</h1>

  <!-- The freedom is yours. You can design the solution however you like, however there is a starting point provided
  to ensure you have both services running. You may want to make use of the Gov UK Components:
  https://design-system.service.gov.uk/components/ to add tabs and so forth :) -->

  {# Build an array of summary HTML for each task #}
  {% set taskSummaries = [] %}
    {% set summaryHtml %}
    {% if task.status == "completed" %}
    {{ govukPanel({
      titleText: "Task completed"
    }) }}
    {% endif %}
    {{ govukSummaryList({
      rows: [
        {
          key: { text: "ID" },
          value: { text: task.id }
        },
        {
          key: { text: "Title" },
          value: { text: task.title }
        },
        {
          key: { text: "Description" },
          value: { html: task.description }
        },
        {
          key: { text: "Status" },
          value: { html: govukTag({
            text: task.formattedStatus,
            classes: statusClass
            })
          },
          actions: {
            items: [
              {
                href: "/editstatus/" + task.id,
                text: "Change"
              }
            ]
          }
        },
        {
          key: { text: "Due Date" },
          value: { html: task.formattedDueDate }
        }
      ]
    }) }}
  {% endset %}
  {% set _ = taskSummaries.push({
    label: task.title,
    id: "task-" ~ task.id,
    panel: { html: summaryHtml | safe }
  }) %}

  {{ govukTabs({
    items: taskSummaries
  }) }}
  <div class="govuk-button-group">
    <!--
    <form action="/edittask" method="post" novalidate>
    <input type="hidden" name="id" value="{{ task.id }}">
      {{ govukButton({
      text: "Edit Task",
      element: "input"
    }) }}
    </form>
    -->
    <form action="/deletetask" method="post" novalidate>
      <input type="hidden" name="id" value="{{ task.id }}">
      {{ govukButton({
        text: "Delete Task",
        classes: "govuk-button--warning",
        preventDoubleClick: true
      }) }}
    </form>
  </div>
{% endblock %}
